<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <title>后台管理系统</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <script src="https://unpkg.com/element-plus"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
        }

        #app {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 200px;
            background-color: #f4f4f4;
        }

        .main {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .chart-container {
            width: 100%;
            height: 400px;
            margin-top: 20px;
        }
    </style>
    <style>
        .app {
            font-family: Arial, sans-serif;
        }
    </style>
</head>

<body>
<div class="app">
    <el-container style="height: 100vh">
        <el-aside width="200px" style="background-color: #f5f7fa">
            <el-menu default-active="1" class="el-menu-vertical-demo" @select="handleMenuSelect">
                <el-menu-item index="1">首页</el-menu-item>
                <el-menu-item index="2">查看所有用户信息</el-menu-item>
                <el-menu-item index="3">用户问卷信息统计分析</el-menu-item>
            </el-menu>
        </el-aside>
        <el-main>
            <div v-if="activePage === 'analysis'">
                <h2>1. 高血压统计</h2>
                <div>
                    <p>1.1 用户患有高血压情况：{{ hypertensionYesPercent }}% 有，{{ hypertensionNoPercent }}% 没有</p>
                    <el-button @click="showChart('hypertension', 'pie')">饼状图</el-button>
                    <el-button @click="showChart('hypertension', 'bar')">柱状图</el-button>
                    <div ref="hypertensionChart" style="width: 600px; height: 400px"></div>

                    <p>1.2 在患有高血压的人中，病程统计：</p>
                    <el-button @click="showChart('year', 'pie')">饼状图</el-button>
                    <el-button @click="showChart('year', 'bar')">柱状图</el-button>
                    <div ref="yearChart" style="width: 600px; height: 400px"></div>

                    <p>1.3 是否长期规律服用药物：</p>
                    <el-button @click="showChart('drug', 'pie')">饼状图</el-button>
                    <el-button @click="showChart('drug', 'bar')">柱状图</el-button>
                    <div ref="drugChart" style="width: 600px; height: 400px"></div>
                </div>

                <h2>2. 糖尿病统计</h2>
                <p>2.1 用户患有糖尿病情况：</p>
                <el-button @click="showChart('diabetes', 'pie')">饼状图</el-button>
                <el-button @click="showChart('diabetes', 'bar')">柱状图</el-button>
                <div ref="diabetesChart" style="width: 600px; height: 400px"></div>

                <p>2.2 在患有糖尿病的人中，病程统计：</p>
                <el-button @click="showChart('diabetesYear', 'pie')">饼状图</el-button>
                <el-button @click="showChart('diabetesYear', 'bar')">柱状图</el-button>
                <div ref="diabetesYearChart" style="width: 600px; height: 400px"></div>

                <p>2.3 是否长期规律服用药物：</p>
                <el-button @click="showChart('diabetesDrug', 'pie')">饼状图</el-button>
                <el-button @click="showChart('diabetesDrug', 'bar')">柱状图</el-button>
                <div ref="diabetesDrugChart" style="width: 600px; height: 400px"></div>

                <h2>3. 高血脂统计</h2>
                <p>3.1 用户患有高血脂情况：</p>
                <el-button @click="showChart('lipid', 'pie')">饼状图</el-button>
                <el-button @click="showChart('lipid', 'bar')">柱状图</el-button>
                <div ref="lipidChart" style="width: 600px; height: 400px"></div>

                <p>3.2 在患有高血脂的人中，病程统计：</p>
                <el-button @click="showChart('lipidYear', 'pie')">饼状图</el-button>
                <el-button @click="showChart('lipidYear', 'bar')">柱状图</el-button>
                <div ref="lipidYearChart" style="width: 600px; height: 400px"></div>

                <p>3.3 是否长期规律服用药物：</p>
                <el-button @click="showChart('lipidDrug', 'pie')">饼状图</el-button>
                <el-button @click="showChart('lipidDrug', 'bar')">柱状图</el-button>
                <div ref="lipidDrugChart" style="width: 600px; height: 400px"></div>

                <h2>4. 肿瘤统计</h2>
                <p>4.1 用户患有肿瘤情况：</p>
                <el-button @click="showChart('tumor', 'pie')">饼状图</el-button>
                <el-button @click="showChart('tumor', 'bar')">柱状图</el-button>
                <div ref="tumorChart" style="width: 600px; height: 400px"></div>
            </div>

            <div v-else-if="activePage === 'users'">
                <!-- 用户信息展示页 -->
            </div>

            <div v-else>
                <h2>欢迎使用用户管理系统</h2>
            </div>
        </el-main>
    </el-container>
</div>

<script>
    import {ref, onMounted} from 'vue'
    import * as echarts from 'echarts'
    import axios from 'axios'

    const activePage = ref('home')
    const handleMenuSelect = (index) => {
        if (index === '1') activePage.value = 'home'
        if (index === '2') activePage.value = 'users'
        if (index === '3') {
            activePage.value = 'analysis'
            loadHypertensionData()
        }
    }

    const hypertensionYesPercent = ref(0)
    const hypertensionNoPercent = ref(0)

    const hypertensionChart = ref(null)
    const yearChart = ref(null)
    const drugChart = ref(null)
    const diabetesChart = ref(null)
    const diabetesYearChart = ref(null)
    const diabetesDrugChart = ref(null)
    const lipidChart = ref(null)
    const lipidYearChart = ref(null)
    const lipidDrugChart = ref(null)
    const tumorChart = ref(null)

    const chartMap = {
        hypertension: hypertensionChart,
        year: yearChart,
        drug: drugChart,
        diabetes: diabetesChart,
        diabetesYear: diabetesYearChart,
        diabetesDrug: diabetesDrugChart,
        lipid: lipidChart,
        lipidYear: lipidYearChart,
        lipidDrug: lipidDrugChart,
        tumor: tumorChart
    }

    const loadHypertensionData = async () => {
        const res = await axios.get('/hypertension/yes-no')
        const yes = res.data.data.yes
        const no = res.data.data.no
        hypertensionYesPercent.value = ((yes / (yes + no)) * 100).toFixed(1)
        hypertensionNoPercent.value = ((no / (yes + no)) * 100).toFixed(1)
    }

    const showChart = async (type, style) => {
        let chartRef = chartMap[type].value
        let chartInstance = echarts.init(chartRef)
        let option = {}

        let res
        if (type === 'hypertension') res = await axios.get('/hypertension/yes-no')
        else if (type === 'year') res = await axios.get('/hypertension/year')
        else if (type === 'drug') res = await axios.get('/hypertension/drug')
        else if (type === 'diabetes') res = await axios.get('/diabetes/yes-no')
        else if (type === 'diabetesYear') res = await axios.get('/diabetes/year')
        else if (type === 'diabetesDrug') res = await axios.get('/diabetes/drug')
        else if (type === 'lipid') res = await axios.get('/lipid/yes-no')
        else if (type === 'lipidYear') res = await axios.get('/lipid/year')
        else if (type === 'lipidDrug') res = await axios.get('/lipid/drug')
        else if (type === 'tumor') res = await axios.get('/tumor/yes-no')

        const data = res.data.data
        if (style === 'pie') {
            option = {
                tooltip: {trigger: 'item'},
                series: [{
                    type: 'pie',
                    radius: '50%',
                    data: type.endsWith('Year') ? data.year.map((y, i) => ({name: y + '年', value: data.people[i]})) : [
                        {value: data.yes, name: '是'},
                        {value: data.no, name: '否'}
                    ]
                }]
            }
        } else {
            option = {
                xAxis: {type: 'category', data: type.endsWith('Year') ? data.year : ['是', '否']},
                yAxis: {type: 'value'},
                series: [{
                    type: 'bar',
                    data: type.endsWith('Year') ? data.people : [data.yes, data.no]
                }]
            }
        }
        chartInstance.setOption(option)
    }
</script>

</body>
</html>