<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <title>登录 / 注册</title>
    <style>
        .form-group {
            margin-bottom: 10px;
        }
        label {
            display: inline-block;
            width: 80px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
<h2 id="formTitle">用户登录</h2>

<form id="authForm">
    <div class="form-group">
        <label for="phone">手机号：</label>
        <input type="text" id="phone" name="phone" required />
    </div>

    <div class="form-group" id="passwordGroup">
        <label for="password">密&nbsp;&nbsp;码：</label>
        <input type="password" id="password" name="password" required />
    </div>

    <!-- 注册特有字段 -->
    <div id="registerFields" class="hidden">
        <div class="form-group">
            <label for="name">姓&nbsp;&nbsp;名：</label>
            <input type="text" id="name" name="name" required />
        </div>
        <div class="form-group">
            <label for="chinaId">身份证号：</label>
            <input type="text" id="chinaId" name="chinaId" required />
        </div>
        <div class="form-group">
            <label for="birthday">出生日期：</label>
            <input type="date" id="birthday" name="birthday" required />
        </div>
        <div class="form-group">
            <label>性&nbsp;&nbsp;别：</label>
            <select id="sex" name="sex" required>
                <option value="1">男</option>
                <option value="2">女</option>
            </select>
        </div>
        <div class="form-group">
            <label for="areaCode">地区编码：</label>
            <input type="number" id="areaCode" name="areaCode" required />
        </div>
    </div>

    <div class="form-group">
        <button type="submit" id="submitBtn">登录</button>
        <button type="button" id="toggleModeBtn">去注册</button>
    </div>
</form>

<div id="result"></div>

<script>
    const authForm = document.getElementById('authForm');
    const formTitle = document.getElementById('formTitle');
    const submitBtn = document.getElementById('submitBtn');
    const toggleModeBtn = document.getElementById('toggleModeBtn');
    const registerFields = document.getElementById('registerFields');
    const passwordGroup = document.getElementById('passwordGroup');

    let isLoginMode = true;

    // 切换登录/注册模式
    toggleModeBtn.addEventListener('click', () => {
        isLoginMode = !isLoginMode;
        if (isLoginMode) {
            formTitle.textContent = '用户登录';
            submitBtn.textContent = '登录';
            toggleModeBtn.textContent = '去注册';
            registerFields.classList.add('hidden');
            passwordGroup.classList.remove('hidden');
        } else {
            formTitle.textContent = '用户注册';
            submitBtn.textContent = '注册';
            toggleModeBtn.textContent = '去登录';
            registerFields.classList.remove('hidden');
            passwordGroup.classList.add('hidden');
        }
    });

    // 表单提交处理
    authForm.addEventListener('submit', function (e) {
        e.preventDefault();

        const phone = document.getElementById('phone').value.trim();
        const password = document.getElementById('password').value || "yzunlp"; // 默认值
        const resultDiv = document.getElementById('result');

        if (isLoginMode) {
            // 登录逻辑
            fetch('/user/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ phone, password })
            })
                .then(res => res.json())
                .then(data => {
                    if (data.code === 1) {
                        localStorage.setItem('token', data.data.token);
                        window.location.href = '/static/home.html';
                    } else {
                        resultDiv.innerText = data.msg || '登录失败';
                    }
                })
                .catch(err => {
                    console.error(err);
                    resultDiv.innerText = '请求失败，请重试';
                });
        } else {
            // 注册逻辑
            const name = document.getElementById('name').value.trim();
            const chinaId = document.getElementById('chinaId').value.trim();
            const birthday = document.getElementById('birthday').value;
            const sex = parseInt(document.getElementById('sex').value);
            const areaCode = parseInt(document.getElementById('areaCode').value);

            const registerDTO = {
                phone,
                name,
                password,
                chinaId,
                birthday,
                sex,
                areaCode
            };

            fetch('/user/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(registerDTO)
            })
                .then(res => res.json())
                .then(() => {
                    alert('注册成功，请登录');
                    // 跳回登录界面，并保留手机号
                    document.getElementById('password').value = '';
                    document.getElementById('phone').readOnly = true;
                    isLoginMode = true;
                    formTitle.textContent = '用户登录';
                    submitBtn.textContent = '登录';
                    toggleModeBtn.textContent = '去注册';
                    registerFields.classList.add('hidden');
                    passwordGroup.classList.remove('hidden');
                })
                .catch(err => {
                    console.error(err);
                    resultDiv.innerText = '注册失败，请重试';
                });
        }
    });
</script>
</body>
</html>